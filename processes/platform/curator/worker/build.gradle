plugins {
	id 'com.google.cloud.tools.jib'
    id 'org.ceskaexpedice.processplatform.worker' version '1.0.5'
}

dependencies {
	// imports
    implementation project(":processes:platform:curator:import-foxml")
    implementation project(":processes:platform:curator:import-ndkmets")

    // search index - indexation
    implementation project(":processes:platform:curator:search-index-model")
    implementation project(":processes:platform:curator:search-index-object")

    // processing index - indexation
    implementation project(":processes:platform:curator:processing-index-repository")
    implementation project(":processes:platform:curator:processing-index-object")

	//delete tree
    implementation project(":processes:platform:curator:delete-tree")

    // licenses
    implementation project(":processes:platform:curator:license-add")
    implementation project(":processes:platform:curator:license-remove")

    // backup collections
    implementation project(":processes:platform:curator:license-add")
    implementation project(":processes:platform:curator:license-remove")

    // flag to license
    implementation project(":processes:platform:curator:flag-to-license")
    // backup-collections
    implementation project(":processes:platform:curator:backup-collections")
    implementation project(":processes:platform:curator:restore-collections")
    // migrate-collections
    implementation project(":processes:platform:curator:migrate-collections")
    // sdnnt-sync
    implementation project(":processes:platform:curator:sdnnt-sync")
    // update-foxml
    implementation project(":processes:platform:curator:update-foxml")

    implementation project(":processes:platform:curator:statistics-p")

}


processWorker {
	workerName = "curatorworker"
	warArtifact = "org.ceskaexpedice:process-worker:${processapiversion}"

	autoShareLibraries = true

	plugins = [
        // imports
        project(":processes:platform:curator:import-ndkmets"),
		project(":processes:platform:curator:import-foxml"),
        // search index - indexation
        project(":processes:platform:curator:search-index-model"),
        project(":processes:platform:curator:search-index-object"),
        // processing index - indexation
        project(":processes:platform:curator:processing-index-repository"),
        project(":processes:platform:curator:processing-index-object"),
		//delete tree
		project(":processes:platform:curator:delete-tree"),
        // licenses
        project(":processes:platform:curator:license-add"),
        project(":processes:platform:curator:license-remove"),


        project(":processes:platform:curator:flag-to-license"),
        project(":processes:platform:curator:backup-collections"),
        project(":processes:platform:curator:restore-collections"),
        project(":processes:platform:curator:migrate-collections"),
        project(":processes:platform:curator:sdnnt-sync"),
        project(":processes:platform:curator:update-foxml"),
        project(":processes:platform:curator:statistics-p")
    ]
}


jib {
    from {
        image = 'tomcat:9.0.87-jdk21-temurin-jammy' 
    }
    to {
        image = "ceskaexpedice/curator-worker:${version}"
    }

    extraDirectories {
        paths {
            path {
				from = project.file('build/worker/webapps').path
                into = '/usr/local/tomcat/webapps' 
            }            
		}
        
        paths {
            path {
                from = project.file('build/worker/lib/plugins')
                into = '/usr/local/tomcat/lib/plugins' 
            }
        }
    }
	container {
		entrypoint = ['/usr/local/tomcat/bin/catalina.sh', 'run']
        user = '0'
    }
}