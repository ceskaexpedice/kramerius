<migration>

    <source-name>$iteration.dl$</source-name>
	<name>$iteration.dl$-full</name>
	<type>full</type>
	
	<workingtime>$iteration.workingtime$</workingtime>
	<timestamp>$timestamp.url$</timestamp>
	

    <!-- Iteration part -->
    <iteration>
        <iteratorFactory class="cz.inovatika.kramerius.services.iterators.factories.SolrIteratorFactory"></iteratorFactory>
        <url>$iteration.url$</url>
        <endpoint>select</endpoint>
        <id>$iteration.id$</id>
        <rows>4000</rows>
        <type>CURSOR</type>
        
        <fquery>$iteration.fquery$</fquery>
        
    </iteration>

    <threads>1</threads>

    <worker>
        <workerFactory class="cz.incad.kramerius.services.workers.copy.cdk.CDKCopySolrWorkerFactory"></workerFactory>
        <request>
            <url>$iteration.url$</url>
            <endpoint>select</endpoint>
            <batchsize>45</batchsize>

            <id>pid</id>

            <composite.id>true</composite.id>
            <composite.root>root.pid</composite.root>
            <composite.child>pid</composite.child>

            <checkUrl>$destination.url$</checkUrl>
            <checkEndpoint>select</checkEndpoint>


            <fieldlist>*</fieldlist>

        </request>

        <destination>
            <url>$destination.url$/update</url>

            <!-- on index -->
            <onindex>
                <!-- remove from batch document -->
                <remove.dest.field>
                    <field>indexer_version</field>
                    <field name="collection"></field>
                    <field name="_version_"></field>
                    <field name="physical_locations.search"></field>
                    <field name="id_all"></field>
                </remove.dest.field>
            </onindex>

            <onupdate>
                <fieldlist>pid root.pid has_tiles count_* has_alto_content has_text_ocr_content licenses contains_licenses licenses_of_ancestors titles.* collection.* in_collections in_collections.* title.* titles.* text_ocr</fieldlist>
            </onupdate>
        </destination>
    </worker>
</migration>
